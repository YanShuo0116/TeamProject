# 測驗系統功能說明

## 🎯 功能概述

新增的測驗系統讓用戶在完成單字學習後，必須通過測驗才能真正完成課程。這確保了學習品質和知識掌握度。

## 📋 測驗流程

### 1. 學習階段
- 用戶正常學習單字，點擊「下一個」標記單字為已學習
- 完成所有單字後，不會直接標記課程完成

### 2. 測驗準備階段
- 顯示測驗說明介面
- 說明3種題型和通過標準（80%正確率）
- 用戶可選擇開始測驗或返回課程

### 3. 測驗進行階段
- 隨機出題，每個已學習的單字都會出現一題
- 題型隨機分配：
  - **中文選英文**：顯示中文和圖片，4個英文選項
  - **英文選中文**：顯示英文和圖片，4個中文選項  
  - **拼字題**：顯示中文，用打亂的字母拼出英文
- 即時顯示答案正確性
- 進度條顯示測驗進度

### 4. 測驗結果階段
- 顯示分數、正確率、完成時間
- 通過（≥80%）：課程標記為完成，顯示綠色
- 未通過（<80%）：可重新測驗，課程保持未完成狀態

## 🎮 題型詳細說明

### 題型1：中文選英文
```
顯示：中文詞彙 + 圖片
選項：4個英文單字（1個正確答案 + 3個干擾項）
干擾項來源：同課程其他單字
```

### 題型2：英文選中文
```
顯示：英文單字 + 圖片
選項：4個中文詞彙（1個正確答案 + 3個干擾項）
干擾項來源：同課程其他單字
```

### 題型3：拼字題
```
顯示：中文詞彙
操作：點擊打亂的字母按鈕拼出英文單字
功能：可清除重新拼寫，完成後提交答案
```

## 🗄️ 資料庫結構

### QuizAttempt（測驗嘗試）
- `user_id`：用戶ID
- `theme_name`：主題名稱
- `lesson_name`：課程名稱
- `total_questions`：總題數
- `correct_answers`：正確答案數
- `is_passed`：是否通過
- `completion_time`：完成時間（秒）
- `started_at`：開始時間
- `completed_at`：完成時間

### QuizQuestion（測驗問題）
- `attempt_id`：測驗嘗試ID
- `word_id`：單字ID
- `question_type`：題型
- `user_answer`：用戶答案
- `is_correct`：是否正確
- `answered_at`：回答時間

## 🔧 API 端點

### POST /api/start_quiz
開始測驗
```json
{
  "theme": "主題名稱",
  "lesson": "課程名稱"
}
```

### GET /api/get_quiz_question/{quiz_id}/{question_index}
獲取測驗問題

### POST /api/submit_quiz_answer
提交答案
```json
{
  "question_id": 123,
  "answer": "用戶答案"
}
```

### POST /api/complete_quiz/{quiz_id}
完成測驗

## 🎨 前端功能

### JavaScript 功能
- `showQuizOption()`：顯示測驗選項
- `startQuiz()`：開始測驗
- `showQuizInterface()`：顯示測驗介面
- `displayQuizQuestion()`：顯示問題
- `submitQuizAnswer()`：提交答案
- `showQuizResults()`：顯示結果

### CSS 樣式
- 測驗選項介面樣式
- 問題顯示樣式
- 選擇題按鈕樣式
- 拼字題互動樣式
- 結果顯示樣式
- 響應式設計

## 📊 評分標準

- **通過標準**：80% 正確率
- **計分方式**：正確答案數 / 總題數
- **時間記錄**：記錄完成時間但不影響分數
- **重試機制**：未通過可無限次重試

## 🔄 學習流程更新

### 舊流程
```
學習單字 → 完成所有單字 → 課程完成（綠色）
```

### 新流程
```
學習單字 → 完成所有單字 → 測驗 → 通過測驗 → 課程完成（綠色）
                                ↓
                              未通過 → 可重新測驗
```

## 🧪 測試方法

### 自動測試
```bash
python test_quiz_system.py
```

### 手動測試
1. 註冊/登入用戶
2. 選擇課程學習單字
3. 完成所有單字學習
4. 點擊「開始測驗」
5. 完成測驗查看結果
6. 檢查課程是否變綠色

## 🎯 特色功能

### 1. 智能題型分配
- 每個單字隨機分配題型
- 確保測驗多樣性

### 2. 干擾項生成
- 優先使用同課程單字作為干擾項
- 提高測驗難度和相關性

### 3. 即時反饋
- 答題後立即顯示正確性
- 錯誤時顯示正確答案

### 4. 進度視覺化
- 測驗進度條
- 分數圓形圖表
- 完成狀態徽章

### 5. 用戶體驗優化
- 流暢的動畫效果
- 響應式設計
- 直觀的操作介面

## 🔮 未來擴展

1. **難度調整**：根據用戶表現調整題目難度
2. **錯題重練**：針對錯誤題目進行重點練習
3. **時間限制**：添加測驗時間限制選項
4. **成就系統**：測驗通過獲得徽章獎勵
5. **統計分析**：詳細的測驗表現分析

## 🎉 總結

測驗系統成功實現了：
- ✅ 3種不同題型的隨機測驗
- ✅ 80%通過標準的品質控制
- ✅ 完整的測驗流程和用戶體驗
- ✅ 資料庫記錄和進度追蹤
- ✅ 美觀的介面設計和動畫效果

現在用戶必須真正掌握單字才能完成課程，大大提升了學習效果！